<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Lab06 - Review of Encryption Algorithms</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=Poppins:wght@500;600;700&display=swap"
      rel="stylesheet"
    />
    <!-- Custom CSS -->
    <link
      href="{{ url_for('static', filename='css/style.css') }}"
      rel="stylesheet"
    />
    <!-- Force file button hover fix -->
    <style>
      input[type="file"]::file-selector-button:hover,
      input[type="file"]::-webkit-file-upload-button:hover {
        background-color: #2563eb !important;
        color: #ffffff !important;
        transform: translateY(-2px) scale(1.02) !important;
        box-shadow: 0 4px 8px rgba(37, 99, 235, 0.3) !important;
      }
    </style>
  </head>

  <body>
    <!-- Theme Toggle Button -->
    <button
      class="theme-toggle"
      id="theme-toggle"
      aria-label="Toggle Dark Mode"
    >
      <!-- Sun Icon -->
      <svg
        class="sun-icon"
        xmlns="http://www.w3.org/2000/svg"
        viewBox="0 0 24 24"
        style="display: none"
      >
        <path
          d="M12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-12c.55 0 1-.45 1-1V3c0-.55-.45-1-1-1s-1 .45-1 1v1c0 .55.45 1 1 1zm0 19c.55 0 1-.45 1-1v-1c0-.55-.45-1-1-1s-1 .45-1 1v1c0 .55.45 1 1 1zm9-10c0 .55-.45 1-1 1h-1c-.55 0-1-.45-1-1s.45-1 1-1h1c.55 0 1 .45 1 1zm-18 0c0 .55-.45 1-1 1H2c-.55 0-1-.45-1-1s.45-1 1-1h1c.55 0 1 .45 1 1zm15.95 6.05c.39.39.39 1.02 0 1.41-.39.39-1.02.39-1.41 0l-.71-.71c-.39-.39-.39-1.02 0-1.41.39-.39 1.02-.39 1.41 0l.71.71zM6.17 5.05c.39-.39 1.02-.39 1.41 0 .39.39.39 1.02 0 1.41l-.71.71c-.39.39-1.02.39-1.41 0-.39-.39-.39-1.02 0-1.41l.71-.71zM17.83 5.05l.71.71c.39.39.39 1.02 0 1.41-.39.39-1.02.39-1.41 0l-.71-.71c-.39-.39-.39-1.02 0-1.41.39-.39 1.02-.39 1.41 0zM5.05 17.83l.71.71c.39.39 1.02.39 1.41 0 .39-.39.39-1.02 0-1.41l-.71-.71c-.39-.39-1.02-.39-1.41 0-.39.39-.39 1.02 0 1.41z"
        />
      </svg>
      <!-- Moon Icon -->
      <svg
        class="moon-icon"
        xmlns="http://www.w3.org/2000/svg"
        viewBox="0 0 24 24"
      >
        <path
          d="M12 3c-4.97 0-9 4.03-9 9s4.03 9 9 9 9-4.03 9-9c0-.46-.04-.92-.1-1.36-.98 1.37-2.58 2.26-4.4 2.26-3.03 0-5.5-2.47-5.5-5.5 0-1.82.89-3.42 2.26-4.4-.44-.06-.9-.1-1.36-.1z"
        />
      </svg>
    </button>

    <div class="container py-4">
      <h1 class="mb-4 text-center fw-bold">
        Lab06 – Review of Encryption Algorithms
      </h1>
      <p class="text-center text-muted mb-4" style="font-size: 1.1rem">
        MSSV: 23521422 - Huỳnh Lê Đại Thắng - UIT
      </p>

      <!-- LAYOUT: VERTICAL TABS (LEFT) + CONTENT (RIGHT) -->
      <div class="row">
        <!-- LEFT COLUMN: NAVIGATION -->
        <div class="col-md-3 mb-4">
          <ul class="nav nav-pills flex-column" id="pills-tab">
            <li class="nav-item">
              <button
                class="nav-link {% if active_tab=='task1' or not active_tab %}active{% endif %} w-100 text-start"
                data-bs-toggle="pill"
                data-bs-target="#task1"
              >
                Task 1 – Caesar
              </button>
            </li>
            <li class="nav-item">
              <button
                class="nav-link {% if active_tab=='task2' %}active{% endif %} w-100 text-start"
                data-bs-toggle="pill"
                data-bs-target="#task2"
              >
                Task 2 – Substitution
              </button>
            </li>
            <li class="nav-item">
              <button
                class="nav-link {% if active_tab=='task3' %}active{% endif %} w-100 text-start"
                data-bs-toggle="pill"
                data-bs-target="#task3"
              >
                Task 3 – Vigenère
              </button>
            </li>
            <li class="nav-item">
              <button
                class="nav-link {% if active_tab=='task4' %}active{% endif %} w-100 text-start"
                data-bs-toggle="pill"
                data-bs-target="#task4"
              >
                Task 4 – DES
              </button>
            </li>
            <li class="nav-item">
              <button
                class="nav-link {% if active_tab=='task5' %}active{% endif %} w-100 text-start"
                data-bs-toggle="pill"
                data-bs-target="#task5"
              >
                Task 5 – AES
              </button>
            </li>
          </ul>
        </div>

        <!-- RIGHT COLUMN: CONTENT -->
        <div class="col-md-9">
          <div class="tab-content">
            <!-- ============================
             TASK 1 – CAESAR
             ============================ -->
            <div
              class="tab-pane fade {% if active_tab=='task1' or not active_tab %}show active{% endif %}"
              id="task1"
            >
              <div class="card shadow-sm">
                <div class="card-body">
                  <h4 class="card-title fw-bold">Task 1 – Caesar Cipher</h4>
                  <p class="text-muted">
                    Upload ciphertext (tiếng Anh, đã mã hóa Caesar). Hệ thống sẽ
                    brute-force 26 khóa và chọn plaintext giống tiếng Anh nhất.
                  </p>

                  <form
                    method="POST"
                    action="{{ url_for('task1_caesar') }}"
                    enctype="multipart/form-data"
                  >
                    <div class="mb-3">
                      <label class="form-label fw-semibold"
                        >Ciphertext file (.txt)</label
                      >
                      <input
                        type="file"
                        name="cipher_file"
                        class="form-control"
                        required
                      />
                    </div>
                    <button type="submit" class="btn btn-primary">
                      Decrypt
                    </button>
                  </form>

                  {% if task1_result %}
                  <hr />
                  <p><strong>Detected Key:</strong> {{ task1_key }}</p>
                  <label class="form-label fw-semibold">Plaintext:</label>
                  <textarea class="form-control" rows="10" readonly>
{{ task1_result }}</textarea
                  >
                  {% endif %}
                </div>
              </div>
            </div>

            <!-- ============================
             TASK 2 – SUBSTITUTION
             ============================ -->
            <div
              class="tab-pane fade {% if active_tab=='task2' %}show active{% endif %}"
              id="task2"
            >
              <div class="card shadow-sm">
                <div class="card-body">
                  <h4 class="card-title fw-bold">
                    Task 2 – Monoalphabetic Substitution Cipher
                  </h4>
                  <p class="text-muted">
                    Upload ciphertext dùng monoalphabetic substitution (chỉ chữ
                    cái a–z được thay thế). Hệ thống dùng hill-climbing để tìm
                    mapping tốt nhất.
                  </p>

                  <form
                    method="POST"
                    action="{{ url_for('task2_substitution') }}"
                    enctype="multipart/form-data"
                  >
                    <div class="mb-3">
                      <label class="form-label fw-semibold"
                        >Ciphertext file (.txt)</label
                      >
                      <input
                        type="file"
                        name="cipher_file"
                        class="form-control"
                        required
                      />
                    </div>
                    <button type="submit" class="btn btn-primary">
                      Crack Cipher
                    </button>
                  </form>

                  {% if task2_result %}
                  <hr />
                  <p><strong>Score:</strong> {{ task2_score }}</p>
                  <p><strong>Mapping:</strong> {{ task2_mapping }}</p>
                  <label class="form-label fw-semibold">Plaintext:</label>
                  <textarea class="form-control" rows="10" readonly>
{{ task2_result }}</textarea
                  >
                  {% endif %}
                </div>
              </div>
            </div>

            <!-- ============================
             TASK 3 – VIGENERE
             ============================ -->
            <div
              class="tab-pane fade {% if active_tab=='task3' %}show active{% endif %}"
              id="task3"
            >
              <div class="card shadow-sm">
                <div class="card-body">
                  <h4 class="card-title fw-bold">
                    Task 3 – Vigenère Cipher (Key Unknown)
                  </h4>
                  <p class="text-muted">
                    Upload ciphertext Vigenère (không biết khóa). Hệ thống ước
                    lượng độ dài khóa bằng Index of Coincidence, sau đó tìm từng
                    ký tự khóa bằng phân tích tần suất.
                  </p>

                  <form
                    method="POST"
                    action="{{ url_for('task3_vigenere') }}"
                    enctype="multipart/form-data"
                  >
                    <div class="mb-3">
                      <label class="form-label fw-semibold"
                        >Ciphertext file (.txt)</label
                      >
                      <input
                        type="file"
                        name="cipher_file"
                        class="form-control"
                        required
                      />
                    </div>
                    <button type="submit" class="btn btn-primary">
                      Break Cipher
                    </button>
                  </form>

                  {% if task3_result %}
                  <hr />
                  <p class="fw-semibold">
                    <span class="text-primary">Recovered Key:</span>
                    <span class="ms-2">{{ task3_key }}</span>
                  </p>
                  <label class="form-label fw-semibold">Plaintext:</label>
                  <textarea class="form-control" rows="10" readonly>
{{ task3_result }}</textarea
                  >
                  {% endif %}
                </div>
              </div>
            </div>

            <!-- ============================
             TASK 4 – DES
             ============================ -->
            <div
              class="tab-pane fade {% if active_tab=='task4' %}show active{% endif %}"
              id="task4"
            >
              <div class="card shadow-sm">
                <div class="card-body">
                  <h4 class="card-title fw-bold">
                    Task 4 – DES Encryption/Decryption
                  </h4>
                  <p class="text-muted">
                    Thực hiện mã hóa/giải mã DES với 2 mode (ECB, CBC). Dữ liệu
                    input & output đều ở dạng hex.
                  </p>

                  <form
                    method="POST"
                    action="{{ url_for('task4_des') }}"
                    enctype="multipart/form-data"
                  >
                    <div class="mb-3">
                      <label class="form-label fw-semibold"
                        >Input file (hex)</label
                      >
                      <input
                        type="file"
                        name="input_file"
                        class="form-control"
                        required
                      />
                      <div class="form-text">
                        Nội dung file phải là chuỗi hex (không có prefix 0x).
                      </div>
                    </div>

                    <div class="row">
                      <div class="col-md-4 mb-3">
                        <label class="form-label fw-semibold">Mode</label>
                        <select class="form-select" name="mode" required>
                          <option value="ECB">ECB</option>
                          <option value="CBC">CBC</option>
                        </select>
                      </div>

                      <div class="col-md-4 mb-3">
                        <label class="form-label fw-semibold">Action</label>
                        <select class="form-select" name="action" required>
                          <option value="encrypt">Encrypt</option>
                          <option value="decrypt">Decrypt</option>
                        </select>
                      </div>

                      <div class="col-md-4 mb-3">
                        <label class="form-label fw-semibold"
                          >Key (hex, 16 chars)</label
                        >
                        <input
                          type="text"
                          name="key"
                          class="form-control"
                          placeholder="0123456789ABCDEF"
                          required
                        />
                        <div class="form-text">
                          8 bytes (16 hex chars) cho DES.
                        </div>
                      </div>
                    </div>

                    <div class="mb-3">
                      <label class="form-label fw-semibold"
                        >IV (hex, 16 chars, optional)</label
                      >
                      <input
                        type="text"
                        name="iv"
                        class="form-control"
                        placeholder="Chỉ dùng cho CBC"
                      />
                      <div class="form-text">Bắt buộc nếu decrypt với CBC.</div>
                    </div>

                    <button type="submit" class="btn btn-primary">
                      Process
                    </button>
                  </form>

                  {% if task4_result %}
                  <hr />
                  <p><strong>IV Used:</strong> {{ task4_iv }}</p>
                  <label class="form-label fw-semibold">Output (hex):</label>
                  <textarea class="form-control" rows="10" readonly>
{{ task4_result }}</textarea
                  >
                  {% endif %}
                </div>
              </div>
            </div>

            <!-- ============================
             TASK 5 – AES
             ============================ -->
            <div
              class="tab-pane fade {% if active_tab=='task5' %}show active{% endif %}"
              id="task5"
            >
              <div class="card shadow-sm">
                <div class="card-body">
                  <h4 class="card-title fw-bold">
                    Task 5 – AES Encryption/Decryption
                  </h4>
                  <p class="text-muted">
                    Thực hiện mã hóa/giải mã AES-128 với mode ECB/CBC. Dữ liệu
                    input & output ở dạng hex.
                  </p>

                  <form
                    method="POST"
                    action="{{ url_for('task5_aes') }}"
                    enctype="multipart/form-data"
                  >
                    <div class="mb-3">
                      <label class="form-label fw-semibold"
                        >Input file (hex)</label
                      >
                      <input
                        type="file"
                        name="input_file"
                        class="form-control"
                        required
                      />
                    </div>

                    <div class="row">
                      <div class="col-md-4 mb-3">
                        <label class="form-label fw-semibold">Mode</label>
                        <select class="form-select" name="mode" required>
                          <option value="ECB">ECB</option>
                          <option value="CBC">CBC</option>
                        </select>
                      </div>

                      <div class="col-md-4 mb-3">
                        <label class="form-label fw-semibold">Action</label>
                        <select class="form-select" name="action" required>
                          <option value="encrypt">Encrypt</option>
                          <option value="decrypt">Decrypt</option>
                        </select>
                      </div>

                      <div class="col-md-4 mb-3">
                        <label class="form-label fw-semibold"
                          >Key (hex, 32 chars)</label
                        >
                        <input
                          type="text"
                          name="key"
                          class="form-control"
                          placeholder="16 bytes = 32 hex chars"
                          required
                        />
                        <div class="form-text">
                          Ví dụ: 2b7e151628aed2a6abf7158809cf4f3c
                        </div>
                      </div>
                    </div>

                    <div class="mb-3">
                      <label class="form-label fw-semibold"
                        >IV (hex, optional)</label
                      >
                      <input
                        type="text"
                        name="iv"
                        class="form-control"
                        placeholder="Chỉ dùng cho CBC"
                      />
                      <div class="form-text">Bắt buộc nếu decrypt với CBC.</div>
                    </div>

                    <button type="submit" class="btn btn-primary">
                      Process
                    </button>
                  </form>

                  {% if task5_result %}
                  <hr />
                  <p><strong>IV Used:</strong> {{ task5_iv }}</p>
                  <label class="form-label fw-semibold">Output (hex):</label>
                  <textarea class="form-control" rows="10" readonly>
{{ task5_result }}</textarea
                  >
                  {% endif %}
                </div>
              </div>
            </div>
          </div>
          <!-- END TAB CONTENT -->
        </div>
      </div>
    </div>
    <!-- END CONTAINER -->

    <footer class="text-center py-4 text-muted small">
      <p class="mb-1">MSSV: 23521422 - Huỳnh Lê Đại Thắng - UIT</p>
      <p>&copy; 2025 Lab06 Encryption Algorithms. All rights reserved.</p>
    </footer>

    <!-- Custom JS -->
    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
